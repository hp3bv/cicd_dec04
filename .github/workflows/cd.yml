name: CD (Deployment to Pages)

on:
  push:
    # This triggers immediately upon merge from development to main
    branches: [ main ] 

jobs:
  Deploy-Pages:
    # CD only needs to run if the CI workflow (which stages the artifact) passed.
    # Since the CI runs on 'development' and the merge push to 'main' doesn't 
    # guarantee a passing CI run on 'main', we rely on the merge being done 
    # only if the 'development' CI passed.
    runs-on: ubuntu-latest
    environment:
      # Use the 'github-pages' environment
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    permissions:
      pages: write
      id-token: write

    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        # This action automatically finds the artifact staged by the 
        # upload-pages-artifact action from the most recent successful run 
        # on the current commit SHA (which is the merge commit).
        uses: actions/deploy-pages@v4
